C51 COMPILER V9.60.7.0   PWM                                                               12/13/2023 11:29:07 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN .\Objects\Pwm.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Driver\Pwm.c LARGE WARNINGLEVEL(1) OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Dri
                    -ver;.\User) DEBUG OBJECTEXTEND PRINT(.\Listings\Pwm.lst) TABS(2) OBJECT(.\Objects\Pwm.obj)

line level    source

   1          #include "Pwm.h"
   2          
   3          /*************  本地变量声明    **************/
   4          #define PWM_PERIOD  222    //设置周期值
   5          void Pwm_init(void)
   6          {
   7   1        
   8   1         P_SW2 |= 0x80;  //扩展寄存器(XFR)访问使能
   9   1         
  10   1         //设置初始占空比
  11   1          PWM1_Duty = 150;
  12   1         // PWM2_Duty = 500;
  13   1         
  14   1         
  15   1          PWMA_CCER1 = 0x00; //写 CCMRx 前必须先清零 CCxE 关闭通道
  16   1          PWMA_CCER2 = 0x00;
  17   1          PWMA_CCMR1 = 0x68; //通道模式配置
  18   1          PWMA_CCMR2 = 0x68;
  19   1        
  20   1        
  21   1        
  22   1          PWMA_CCER1 = 0x55; //配置通道输出使能和极性  1PN  /2 PN
  23   1      
  24   1      
  25   1          PWMA_ARRH = (u8)(PWM_PERIOD >> 8); //设置周期时间 N = （T目标*时钟频率）/2 =111  占空比为50%  108khz=9
             -.026us
  26   1          PWMA_ARRL = (u8)PWM_PERIOD;
  27   1      
  28   1          PWMA_ENO = 0x00;
  29   1          PWMA_ENO |= ENO1P; //使能输出
  30   1          PWMA_ENO |= ENO1N; //使能输出
  31   1          //PWMA_ENO |= ENO2P; //使能输出
  32   1          //PWMA_ENO |= ENO2N; //使能输出
  33   1          
  34   1          
  35   1          PWMA_PS = 0x00;  //高级 PWM 通道输出脚选择位
  36   1          PWMA_PS |= PWM1_1; //选择 PWM1_3 通道P:P1.0  N:P1.1(雾化器)
  37   1         // PWMA_PS |= PWM2_2; //选择 PWM2_3 通道P:P2.2  N:P2.3（led）
  38   1          
  39   1          PWMA_BKR = 0x80; //使能主输出
  40   1          PWMA_CR1 |= 0x01; //开始计时
  41   1        
  42   1      
  43   1      
  44   1      
  45   1        
  46   1       }
  47           
  48           //========================================================================
  49          // 函数: UpdatePwm(void)
  50          // 描述: 更新PWM占空比. 
  51          // 参数: none.
  52          // 返回: none.
  53          //========================================================================
C51 COMPILER V9.60.7.0   PWM                                                               12/13/2023 11:29:07 PAGE 2   

  54          void UpdatePwm(void)
  55          {
  56   1          PWMA_CCR1H = (u8)(PWM1_Duty >> 8); //设置占空比时间
  57   1          PWMA_CCR1L = (u8)(PWM1_Duty);
  58   1         // PWMA_CCR2H = (u8)(PWM2_Duty >> 8); //设置占空比时间
  59   1        //  PWMA_CCR2L = (u8)(PWM2_Duty);
  60   1      
  61   1      }
  62          
  63          void Setting_Pwm(u16 Duty1)
  64          {
  65   1        
  66   1          PWM1_Duty = Duty1;
  67   1          UpdatePwm();
  68   1      }
  69          
  70          
  71           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    104    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
