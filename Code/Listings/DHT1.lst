C51 COMPILER V9.60.7.0   DHT1                                                              12/06/2023 21:40:06 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DHT1
OBJECT MODULE PLACED IN .\Objects\DHT1.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Driver\DHT1.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Driver;.\User) DEBUG OBJ
                    -ECTEXTEND PRINT(.\Listings\DHT1.lst) TABS(2) OBJECT(.\Objects\DHT1.obj)

line level    source

   1          /**********************************
   2          12Mhz晶振，其他晶振需要修改延迟函数
   3           receive_DHT11()返回值含义：
   4           0:不响应  
   5           11:接收时超时错误  
   6           22:接收结果校验错误  
   7           88:接收成功
   8           
   9          extern uchar recev[5];//DHT11数据 
  10          receive_DHT11();//调用的函数
  11           
  12          调用函数并执行完后，
  13          数组recev的值即为DHT11的数据，其各个成员数据含义如下：
  14          0：湿度整数；1：湿度小数；
  15          2：温度高位；3：温度低位 4为校验位
  16          ***********************************/
  17           
  18          #include "DHT1.h"
  19          sbit DATA = P1^7;
  20           
  21          uchar recev[5]={1,1,1,1,1};
  22           
  23          void Delayms(uchar a)   //@12.000MHz
  24          {
  25   1        unsigned char i, j;
  26   1      for(a;a>0;a--)
  27   1        {
  28   2        i = 24;
  29   2        j = 338;
  30   2        do
  31   2        {
  32   3          while (--j);
  33   3        } while (--i);
  34   2        }
  35   1      }
  36           
  37          uchar receive_DHT11(void)
  38          {
  39   1        uchar i=0,T=0,a=0,AF=0;
  40   1       
  41   1      /*呼叫模块*/
  42   1        DATA = 1;//拉高后等待回应
  43   1        DATA =0;
  44   1        Delayms(20);  
  45   1        DATA = 1;//拉高后等待回应
  46   1       
  47   1      /*模块响应*/
  48   1        while(DATA == 1)
  49   1        {a++;if(a>=40)return 0;}
  50   1        while(DATA == 0)//响应后拉低80us,这里等待高电平到来
  51   1        {a++;if(a>80)return 1;}
  52   1        while(DATA==1);
  53   1        
  54   1      /*数据传输处理*/
C51 COMPILER V9.60.7.0   DHT1                                                              12/06/2023 21:40:06 PAGE 2   

  55   1        for(a=0;a<5;a++)
  56   1        {
  57   2          for(i=0;i<8;i++)
  58   2          { 
  59   3            T=0;
  60   3            while(DATA == 0);//等待80US的低电平过去
  61   3            while(DATA == 1)T++;//估算高电平时间  
  62   3            if(T<40)recev[a]=recev[a]<<1;//数据0
  63   3              else {recev[a]=recev[a]<<1;recev[a]++;}//数据1
  64   3          } 
  65   2          if(a<4)
  66   2          AF=AF+recev[a];//获取前4位和
  67   2        }
  68   1        
  69   1      /*数据校验*/
  70   1        if(AF == recev[4])
  71   1          return 88;//传输无错误
  72   1        else return 22;
  73   1       
  74   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
