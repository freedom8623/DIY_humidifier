C51 COMPILER V9.60.7.0   KEY                                                               12/13/2023 16:45:22 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Driver\key.c LARGE WARNINGLEVEL(1) OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Dri
                    -ver;.\User) DEBUG OBJECTEXTEND PRINT(.\Listings\key.lst) TABS(2) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "key.h"
   2          
   3          //按键引脚定义
   4          sbit KEY1 = P3^2;
   5          sbit KEY2 = P3^3;
   6          sbit KEY3 = P3^4;
   7          sbit KEY4 = P3^5;
   8          int Key_T;
   9          void key_read(void)
  10          {
  11   1        
  12   1        uchar i;
  13   1        
  14   1        
  15   1        if(Key_T%10==0)
  16   1        {
  17   2          Key_T = 0;
  18   2              //第一步读取按键状态
  19   2            key[0].key_sta = KEY1;
  20   2            key[1].key_sta = KEY2;
  21   2            key[2].key_sta = KEY3;
  22   2            key[3].key_sta = KEY4;
  23   2        
  24   2          //遍历
  25   2          for(i = 0;i <4; i++)
  26   2          {
  27   3            switch(key[i].judge_sta)
  28   3            {
  29   4              case 0 :
  30   4              {
  31   5                //第一步是为了消抖
  32   5              if(key[i].key_sta == 0)
  33   5                {
  34   6                key[i].judge_sta = 1;
  35   6                key[i].key_time = 0;
  36   6                
  37   6                }
  38   5              }
  39   4                break;
  40   4                
  41   4              case 1 :
  42   4              {
  43   5              //如果key_sta == 0证明按键确实被按下
  44   5              if(key[i].key_sta == 0)
  45   5                {
  46   6                  key[i].judge_sta = 2;
  47   6      
  48   6                }
  49   5              else
  50   5                {
  51   6                key[i].judge_sta = 0;
  52   6                }
  53   5              }
  54   4              break;
C51 COMPILER V9.60.7.0   KEY                                                               12/13/2023 16:45:22 PAGE 2   

  55   4                        
  56   4              case 2 :
  57   4              {
  58   5                //证明按下后松手
  59   5                  if(key[i].key_sta == 1)
  60   5                {
  61   6                  key[i].judge_sta = 0;
  62   6                      //确定是否为短按
  63   6                  if(key[i].key_time<=70)
  64   6                    {
  65   7                    key[i].single_flag = 1;
  66   7                    }
  67   6                  
  68   6                }
  69   5                  else
  70   5                {
  71   6                  key[i].key_time++;
  72   6                  //判断如果按下时间大于70ms长按标志位置为1
  73   6                  if(key[i].key_time>70)
  74   6                    key[i].longkey_flag = 1;
  75   6                }
  76   5              }
  77   4              break;
  78   4                        
  79   4            }       
  80   3          }
  81   2        
  82   2        }
  83   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    409    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
