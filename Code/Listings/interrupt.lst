C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/16/2023 23:06:53 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE INTERRUPT
OBJECT MODULE PLACED IN .\Objects\interrupt.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE User\interrupt.c LARGE WARNINGLEVEL(1) OPTIMIZE(8,SPEED) BROWSE INCDIR(.
                    -\Driver;.\User) DEBUG OBJECTEXTEND PRINT(.\Listings\interrupt.lst) TABS(2) OBJECT(.\Objects\interrupt.obj)

line level    source

   1          #include "interrupt.h"
   2          #include "ws2812b.h"
   3          #include "Menu.h"
   4          #include "RGB_Font.h"
   5          
   6          //定时器2中断主要用于系统时钟
   7          //定时器1ns
   8          //定时器1ns
   9          
  10          int T_Tick;
  11          char  leddata[] = {000,256,000};
  12          char  leddata2[] = {256,000,10};
  13          int water_T = 0;
  14          extern unsigned int DHT_T;
  15          void timer2_int (void) interrupt 12
  16          {
  17   1      //  T_Tick ++;
  18   1      //  
  19   1      //  if(++water_T == 500) water_T = 0;
  20   1      //  if(++DHT_T == 200) DHT_T = 0;
  21   1      //  
  22   1      //  //WS_SendData(&leddata2);
  23   1      
  24   1      
  25   1      }
  26          
  27          
  28          extern unsigned int Water_Flag;
  29          
  30          
  31          void Alertor(unsigned int i)
  32          {
  33   1      
  34   1        
  35   1            if(Water_test == 1)
  36   1          {
  37   2            
  38   2      //      leddata2[1] = new_light_mode;
  39   2          switch(i){
  40   3          case 0:
  41   3          WS_SendData(colorcode[0]);
  42   3          break;
  43   3        
  44   3          case 1:
  45   3          WS_SendData(colorcode[1]);
  46   3          break;
  47   3        
  48   3          case 2:
  49   3          WS_SendData(colorcode[2]);
  50   3          break;
  51   3        
  52   3          case 3:
  53   3          WS_SendData(colorcode[3]);
  54   3          break;
C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/16/2023 23:06:53 PAGE 2   

  55   3        
  56   3          case 4:
  57   3          WS_SendData(colorcode[4]);
  58   3          break;
  59   3        
  60   3          case 5:
  61   3          WS_SendData(colorcode[5]);
  62   3          break;
  63   3          } 
  64   2          }
  65   1          if(Water_test == 0)
  66   1          {
  67   2            Water_Flag=0;
  68   2            WS_SendData(&leddata);    
  69   2          }
  70   1      }
  71          
  72          //定时器3中断主要用于按键中断
  73          struct keys key[4] = {0,0,0};
  74          
  75          
  76          //按键引脚定义
  77          sbit KEY1 = P3^2;
  78          sbit KEY2 = P3^3;
  79          sbit KEY3 = P3^4;
  80          sbit KEY4 = P3^5;
  81          
  82          void timer3_int(void) interrupt 19
  83          {
  84   1        uchar i;
  85   1        
  86   1              //第一步读取按键状态
  87   1            key[0].key_sta = KEY1;
  88   1            key[1].key_sta = KEY2;
  89   1            key[2].key_sta = KEY3;
  90   1            key[3].key_sta = KEY4;
  91   1        
  92   1          //遍历
  93   1          for(i = 0;i <4; i++)
  94   1          {
  95   2            switch(key[i].judge_sta)
  96   2            {
  97   3              case 0 :
  98   3              {
  99   4                //第一步是为了消抖
 100   4              if(key[i].key_sta == 0)
 101   4                {
 102   5                key[i].judge_sta = 1;
 103   5                key[i].key_time = 0;
 104   5                
 105   5                }
 106   4              }
 107   3                break;
 108   3                
 109   3              case 1 :
 110   3              {
 111   4              //如果key_sta == 0证明按键确实被按下
 112   4              if(key[i].key_sta == 0)
 113   4                {
 114   5                  key[i].judge_sta = 2;
 115   5                  
 116   5                }
C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/16/2023 23:06:53 PAGE 3   

 117   4              else
 118   4                {
 119   5                key[i].judge_sta = 0;
 120   5                }
 121   4              }
 122   3              break;
 123   3                        
 124   3              case 2 :
 125   3              {
 126   4                key[i].key_time++;
 127   4                //证明按下后松手
 128   4                  if(key[i].key_sta == 1)
 129   4                {
 130   5                  key[i].judge_sta = 0;
 131   5                      //确定是否为短按
 132   5                  if(key[i].key_time<=100)
 133   5                    {
 134   6                    key[i].single_flag = 1;
 135   6                    }else
 136   5                    {
 137   6                    key[i].longkey_flag = 1;
 138   6                    }
 139   5                  }
 140   4              break;
 141   4              }
 142   3                        
 143   3            }       
 144   2        
 145   2        }
 146   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    469    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     60    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
