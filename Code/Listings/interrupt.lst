C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/14/2023 21:00:09 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE INTERRUPT
OBJECT MODULE PLACED IN .\Objects\interrupt.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE User\interrupt.c LARGE WARNINGLEVEL(1) OPTIMIZE(8,SPEED) BROWSE INCDIR(.
                    -\Driver;.\User) DEBUG OBJECTEXTEND PRINT(.\Listings\interrupt.lst) TABS(2) OBJECT(.\Objects\interrupt.obj)

line level    source

   1          #include "interrupt.h"
   2          #include "ws2812b.h"
   3          #include "Menu.h"
   4          //定时器2中断主要用于系统时钟
   5          //定时器1ns
   6          //定时器1ns
   7          unsigned int new_light_mode;
   8          int T_Tick;
   9          char  leddata[] = {000,256,000};
  10          char  leddata2[] = {256,000,10};
  11          int water_T = 0;
  12          extern unsigned int DHT_T;
  13          void timer2_int (void) interrupt 12
  14          {
  15   1      //  T_Tick ++;
  16   1      //  
  17   1      //  if(++water_T == 500) water_T = 0;
  18   1      //  if(++DHT_T == 200) DHT_T = 0;
  19   1      //  
  20   1      //  //WS_SendData(&leddata2);
  21   1      
  22   1      
  23   1      }
  24          
  25          
  26          extern unsigned int Water_Flag;
  27          
  28          
  29          void Alertor(void)
  30          {
  31   1      
  32   1        
  33   1            if(Water_test == 1)
  34   1          {
  35   2            
  36   2      //      leddata2[1] = new_light_mode;
  37   2            Water_Flag=1;
  38   2            WS_SendData(&leddata2);   
  39   2          }
  40   1          if(Water_test == 0)
  41   1          {
  42   2            Water_Flag=0;
  43   2            WS_SendData(&leddata);    
  44   2          }
  45   1      }
  46          
  47          //定时器3中断主要用于按键中断
  48          struct keys key[4] = {0,0,0};
  49          
  50          
  51          //按键引脚定义
  52          sbit KEY1 = P3^2;
  53          sbit KEY2 = P3^3;
  54          sbit KEY3 = P3^4;
C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/14/2023 21:00:09 PAGE 2   

  55          sbit KEY4 = P3^5;
  56          
  57          void timer3_int(void) interrupt 19
  58          {
  59   1        uchar i;
  60   1        
  61   1              //第一步读取按键状态
  62   1            key[0].key_sta = KEY1;
  63   1            key[1].key_sta = KEY2;
  64   1            key[2].key_sta = KEY3;
  65   1            key[3].key_sta = KEY4;
  66   1        
  67   1          //遍历
  68   1          for(i = 0;i <4; i++)
  69   1          {
  70   2            switch(key[i].judge_sta)
  71   2            {
  72   3              case 0 :
  73   3              {
  74   4                //第一步是为了消抖
  75   4              if(key[i].key_sta == 0)
  76   4                {
  77   5                key[i].judge_sta = 1;
  78   5                key[i].key_time = 0;
  79   5                
  80   5                }
  81   4              }
  82   3                break;
  83   3                
  84   3              case 1 :
  85   3              {
  86   4              //如果key_sta == 0证明按键确实被按下
  87   4              if(key[i].key_sta == 0)
  88   4                {
  89   5                  key[i].judge_sta = 2;
  90   5                  key[i].key_time++;
  91   5                }
  92   4              else
  93   4                {
  94   5                key[i].judge_sta = 0;
  95   5                }
  96   4              }
  97   3              break;
  98   3                        
  99   3              case 2 :
 100   3              {
 101   4                //证明按下后松手
 102   4                  if(key[i].key_sta == 1)
 103   4                {
 104   5                  key[i].judge_sta = 0;
 105   5                      //确定是否为短按
 106   5                  if(key[i].key_time<=100)
 107   5                    {
 108   6                    key[i].single_flag = 0;
 109   6                    }else
 110   5                    {
 111   6                    key[i].longkey_flag = 1;
 112   6                    }
 113   5                  }
 114   4              break;
 115   4              }
 116   3                        
C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/14/2023 21:00:09 PAGE 3   

 117   3            }       
 118   2        
 119   2        }
 120   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    407    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     44    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
